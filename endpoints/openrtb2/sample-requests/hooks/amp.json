{
  "description": "Amp request",
  "query": "tag_id=101&trace=verbose",
  "config": {
    "mockBidders": [
      {"bidderName": "appnexus", "currency": "USD", "price": 2}
    ]
  },
  "mockBidRequest": {
    "id": "request-with-user-ext-obj",
    "site": {
      "page": "test.somepage.com"
    },
    "imp": [
      {
        "id": "my-imp-id",
        "banner": {
          "format": [
            {
              "w": 300,
              "h": 600
            }
          ]
        },
        "ext": {
          "prebid": {
            "bidder": {
              "appnexus": {
                "placementId": 12883451
              }
            }
          }
        }
      }
    ],
    "user": {
      "ext": {
        "prebid": {
          "buyeruids": {
            "unknown": "123"
          }
        }
      }
    },
    "ext": {
      "prebid": {
        "debug": true,
        "aliases": {
          "unknown": "appnexus"
        }
      }
    }
  },
  "expectedAmpResponse": {
    "targeting": {
      "hb_bidder": "appnexus",
      "hb_bidder_appnexus": "appnexus",
      "hb_cache_host": "www.pbcserver.com",
      "hb_cache_host_appnex": "www.pbcserver.com",
      "hb_cache_id": "0",
      "hb_cache_id_appnexus": "0",
      "hb_cache_path": "/pbcache/endpoint",
      "hb_cache_path_appnex": "/pbcache/endpoint",
      "hb_pb": "2.00",
      "hb_pb_appnexus": "2.00"
    },
    "ortb2": {
      "ext": {
        "prebid": {
          "modules": {
            "errors": {
              "foobar": {
                "foo": [
                  "error 1"
                ],
                "bar": [
                  "error 1"
                ]
              }
            },
            "warnings": {
              "foobar": {
                "bar": [
                  "warning 1"
                ],
                "baz": [
                  "Endpoint /openrtb2/amp is not supported by hook."
                ]
              }
            },
            "trace": {
              "stages": [
                {
                  "stage": "entrypoint",
                  "outcomes": [
                    {
                      "entity": "http-request",
                      "groups": [
                        {
                          "invocationresults": [
                            {
                              "analyticstags": {},
                              "hookid": {
                                "module-code": "foobar",
                                "hook-impl-code": "foo"
                              },
                              "status": "success",
                              "action": "update",
                              "message": "",
                              "debugmessages": [
                                "Hook mutation successfully applied, affected key: header.foo, mutation type: update"
                              ]
                            },
                            {
                              "analyticstags": {},
                              "hookid": {
                                "module-code": "foobar",
                                "hook-impl-code": "bar"
                              },
                              "status": "success",
                              "action": "update",
                              "message": "",
                              "debugmessages": [
                                "Hook mutation successfully applied, affected key: param.foo, mutation type: update"
                              ]
                            }
                          ]
                        },
                        {
                          "invocationresults": [
                            {
                              "analyticstags": {},
                              "hookid": {
                                "module-code": "foobar",
                                "hook-impl-code": "baz"
                              },
                              "status": "success",
                              "action": "no_action",
                              "message": ""
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          }
        }
      }
    }
  },
  "expectedReturnCode": 200
}